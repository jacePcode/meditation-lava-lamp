<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1">
<title>Lava Flow - Meditation</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#0a0510}
#canvas{position:fixed;top:0;left:0;width:100%;height:100%;touch-action:none;z-index:1}
.controls{position:fixed;bottom:0;left:0;right:0;background:rgba(15,5,25,0.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);padding:20px;padding-bottom:max(20px,env(safe-area-inset-bottom));border-top:1px solid rgba(255,255,255,0.08);z-index:100;transform:translateY(0);transition:transform 0.3s ease}
.controls.hidden{transform:translateY(calc(100% - 50px))}
.handle{width:40px;height:4px;background:rgba(255,255,255,0.3);border-radius:2px;margin:0 auto 15px;cursor:pointer}
.slider-row{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:15px}
.slider-item{flex:1;min-width:80px}
.slider-item label{display:block;color:rgba(255,255,255,0.5);font-size:10px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:6px}
.slider-item input[type="range"]{-webkit-appearance:none;appearance:none;width:100%;height:4px;border-radius:2px;background:rgba(255,255,255,0.1);outline:none}
.slider-item input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:linear-gradient(135deg,#a855f7,#ec4899);cursor:pointer;box-shadow:0 2px 8px rgba(168,85,247,0.5)}
.btn-row{display:flex;gap:8px;flex-wrap:wrap}
.btn{flex:1;min-width:60px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:12px 8px;color:rgba(255,255,255,0.7);font-size:11px;cursor:pointer;transition:all 0.2s;display:flex;flex-direction:column;align-items:center;gap:4px}
.btn:active{transform:scale(0.95)}
.btn.active{background:linear-gradient(135deg,rgba(168,85,247,0.3),rgba(236,72,153,0.3));border-color:rgba(236,72,153,0.3);color:#fff}
.btn svg{width:20px;height:20px;fill:currentColor}
.breathing-circle{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:150px;height:150px;border-radius:50%;border:2px solid rgba(168,85,247,0.3);pointer-events:none;opacity:0;z-index:50;transition:opacity 0.5s}
.breathing-circle.active{opacity:1;animation:breathe 8s ease-in-out infinite}
@keyframes breathe{0%,100%{transform:translate(-50%,-50%) scale(0.5);border-color:rgba(168,85,247,0.2)}50%{transform:translate(-50%,-50%) scale(1);border-color:rgba(236,72,153,0.4)}}
.timer{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(15,5,25,0.8);padding:10px 20px;border-radius:20px;color:#fff;font-size:18px;font-weight:300;opacity:0;transition:opacity 0.3s;z-index:100}
.timer.active{opacity:1}
.title{position:fixed;top:20px;left:20px;color:rgba(255,255,255,0.2);font-size:12px;font-weight:300;z-index:100;letter-spacing:2px;text-transform:uppercase}
</style>
</head>
<body>
<div class="title">Lava Flow</div>
<div class="timer" id="timer">5:00</div>
<div class="breathing-circle" id="breathing"></div>
<canvas id="canvas"></canvas>
<div class="controls" id="controls">
<div class="handle" onclick="toggleControls()"></div>
<div class="slider-row">
<div class="slider-item"><label>ðŸŒˆ Color</label><input type="range" id="hue" min="0" max="360" value="280"></div>
<div class="slider-item"><label>âš¡ Speed</label><input type="range" id="speed" min="20" max="200" value="100"></div>
<div class="slider-item"><label>ðŸ”˜ Size</label><input type="range" id="size" min="30" max="100" value="60"></div>
<div class="slider-item"><label>âœ¨ Glow</label><input type="range" id="glow" min="0" max="100" value="60"></div>
<div class="slider-item"><label>ðŸ”Š Volume</label><input type="range" id="vol" min="0" max="100" value="30"></div>
</div>
<div class="btn-row">
<button class="btn" id="audioBtn" onclick="toggleAudio()"><svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>Audio</button>
<button class="btn" id="breathBtn" onclick="toggleBreathing()"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/></svg>Breathe</button>
<button class="btn" id="timerBtn" onclick="cycleTimer()"><svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>Timer</button>
<button class="btn" onclick="goFullscreen()"><svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>Full</button>
</div>
</div>

<script>
const canvas=document.getElementById('canvas'),ctx=canvas.getContext('2d');
let W,H,blobs=[],touchPoints=[],audioCtx=null,masterGain=null,droneOsc=null,droneOsc2=null;
let audioOn=false,breathingOn=false,timerMins=0,timerSecs=0,timerInt=null;
let settings={hue:280,speed:1,size:60,glow:0.6,vol:0.3};

function resize(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;}
resize();window.addEventListener('resize',resize);

class Blob{
constructor(yPos){
this.x=Math.random()*W;
this.y=yPos!==undefined?yPos:H+Math.random()*100;
this.vx=(Math.random()-0.5)*0.3;
this.vy=-0.5-Math.random()*0.3;
this.radius=settings.size*(0.5+Math.random()*0.5);
this.hueOff=Math.random()*50-25;
this.phase=Math.random()*Math.PI*2;
this.wobbleSpeed=1+Math.random();
}
update(dt){
this.vy-=0.01*dt*60*settings.speed;
this.vy*=0.998;
this.vx+=(Math.random()-0.5)*0.01;
this.vx*=0.99;
this.phase+=this.wobbleSpeed*dt;
this.x+=this.vx*dt*60*settings.speed+Math.sin(this.phase)*0.5;
this.y+=this.vy*dt*60*settings.speed;
for(let t of touchPoints){
let dx=t.x-this.x,dy=t.y-this.y,d=Math.sqrt(dx*dx+dy*dy);
if(d<150&&d>0){
let f=(150-d)/150*0.8;
this.vx+=dx/d*f;this.vy+=dy/d*f;
}
}
if(this.y<-this.radius*2)this.reset();
if(this.x<0)this.x=W;if(this.x>W)this.x=0;
}
reset(){this.x=Math.random()*W;this.y=H+50;this.vy=-0.5-Math.random()*0.3;}
draw(){
let h=(settings.hue+this.hueOff)%360,r=this.radius*(1+Math.sin(this.phase)*0.15);
ctx.save();
let grad=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,r);
grad.addColorStop(0,`hsla(${h},80%,55%,0.9)`);
grad.addColorStop(0.4,`hsla(${h},70%,45%,0.7)`);
grad.addColorStop(0.7,`hsla(${h},60%,35%,0.4)`);
grad.addColorStop(1,`hsla(${h},50%,25%,0)`);
ctx.fillStyle=grad;
ctx.beginPath();ctx.arc(this.x,this.y,r,0,Math.PI*2);ctx.fill();
if(settings.glow>0.3){
ctx.globalAlpha=settings.glow*0.5;
ctx.shadowColor=`hsla(${h},80%,50%,1)`;
ctx.shadowBlur=40*settings.glow;
ctx.beginPath();ctx.arc(this.x,this.y,r*0.8,0,Math.PI*2);ctx.fill();
}
ctx.restore();
}
}

for(let i=0;i<18;i++){let b=new Blob(Math.random()*H);blobs.push(b);}

function drawBg(){
let g=ctx.createLinearGradient(0,0,0,H);
g.addColorStop(0,'#08040d');g.addColorStop(0.5,'#12081f');g.addColorStop(1,'#1a0a28');
ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
}
function drawRipples(){
for(let i=touchPoints.length-1;i>=0;i--){
let t=touchPoints[i];t.life-=dt*2;
if(t.life<=0){touchPoints.splice(i,1);continue}
ctx.beginPath();ctx.arc(t.x,t.y,(1-t.life)*80,0,Math.PI*2);
ctx.strokeStyle=`hsla(${settings.hue},60%,50%,${t.life*0.2})`;ctx.lineWidth=2;ctx.stroke();
}
}
let lastT=0,dt=0;
function loop(t){
dt=Math.min((t-lastT)/1000,0.05);lastT=t;
drawBg();
for(let b of blobs)b.update(dt);
for(let b of blobs)b.draw();
drawRipples();
requestAnimationFrame(loop);
}
loop(0);

canvas.addEventListener('mousedown',e=>{touchPoints.push({x:e.clientX,y:e.clientY,life:1});});
canvas.addEventListener('mousemove',e=>{if(e.buttons)touchPoints.push({x:e.clientX,y:e.clientY,life:1});});
canvas.addEventListener('touchstart',e=>{e.preventDefault();for(let t of e.changedTouches)touchPoints.push({x:t.clientX,y:t.clientY,life:1});},{passive:false});
canvas.addEventListener('touchmove',e=>{e.preventDefault();for(let t of e.changedTouches)touchPoints.push({x:t.clientX,y:t.clientY,life:1});},{passive:false});

function initAudio(){
if(audioCtx)return;
audioCtx=new(window.AudioContext||window.webkitAudioContext)();
masterGain=audioCtx.createGain();masterGain.gain.value=0;masterGain.connect(audioCtx.destination);
droneOsc=audioCtx.createOscillator();droneOsc.type='sine';droneOsc.frequency.value=55;
droneOsc2=audioCtx.createOscillator();droneOsc2.type='sine';droneOsc2.frequency.value=110;
let g1=audioCtx.createGain();g1.gain.value=0.5;let g2=audioCtx.createGain();g2.gain.value=0.3;
droneOsc.connect(g1);g1.connect(masterGain);droneOsc2.connect(g2);g2.connect(masterGain);
droneOsc.start();droneOsc2.start();
}
function toggleAudio(){
initAudio();
audioOn=!audioOn;
masterGain.gain.setTargetAtTime(audioOn?settings.vol:0,audioCtx.currentTime,0.3);
document.getElementById('audioBtn').classList.toggle('active',audioOn);
}
function toggleBreathing(){
breathingOn=!breathingOn;
document.getElementById('breathing').classList.toggle('active',breathingOn);
document.getElementById('breathBtn').classList.toggle('active',breathingOn);
}
function cycleTimer(){
const times=[0,5,10,15,20];const idx=times.indexOf(timerMins);
timerMins=times[(idx+1)%times.length];
clearInterval(timerInt);
let btn=document.getElementById('timerBtn'),display=document.getElementById('timer');
if(timerMins>0){
timerSecs=timerMins*60;display.classList.add('active');btn.classList.add('active');
updateTimer();
timerInt=setInterval(()=>{timerSecs--;updateTimer();if(timerSecs<=0){clearInterval(timerInt);timerMins=0;btn.classList.remove('active');display.classList.remove('active');}},1000);
}else{btn.classList.remove('active');display.classList.remove('active');}
btn.querySelector('svg+*')?.remove();btn.appendChild(document.createTextNode(timerMins>0?timerMins+'m':'Timer'));
}
function updateTimer(){let m=Math.floor(timerSecs/60),s=timerSecs%60;document.getElementById('timer').textContent=m+':'+(s<10?'0':'')+s;}
function goFullscreen(){if(!document.fullscreenElement)document.documentElement.requestFullscreen();else document.exitFullscreen();}
function toggleControls(){document.getElementById('controls').classList.toggle('hidden');}

document.getElementById('hue').addEventListener('input',e=>settings.hue=+e.target.value);
document.getElementById('speed').addEventListener('input',e=>settings.speed=e.target.value/100);
document.getElementById('size').addEventListener('input',e=>{settings.size=+e.target.value;blobs.forEach(b=>b.radius=settings.size*(0.5+Math.random()*0.5));});
document.getElementById('glow').addEventListener('input',e=>settings.glow=e.target.value/100);
document.getElementById('vol').addEventListener('input',e=>{settings.vol=e.target.value/100;if(audioOn&&masterGain)masterGain.gain.setTargetAtTime(settings.vol,audioCtx.currentTime,0.1);});
</script>
</body>
</html>
